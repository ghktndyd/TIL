# 프로세스와 스레드

## 프로세스

- 운영체제에 의해 파일 시스템에 설치되어 있는 파일을 **프로그램**이라고 한다.
- 프로세스는 프로그램을 실제로 실행함으로써 프로그램 데이터들이 메모리에 올라와서 CPU를 할당받고, 명령을 실행하는 상태를 말함
- 정확하게는 CPU를 할당받는 것은 스레드고, 프로세스는 스레드가 실행될 수 있는 환경을 제공하는 역할을 함
- 프로세스는 운영체제로부터 자원을 할당받은 최소 실행 단위

### 프로세스의 요소

> 스택, 힙, 데이터 영역, 코드 영역

- 스택 (동적 메모리 영역)
    - 함수 안에서 사용되는 지역변수랑 매개변수, 리턴 값 등을 저장
    - 함수 호출과 함께 생성되고, 함수 종료와 함께 소멸함

- 힙 (동적 메모리 영역)
    - 사용자가 동적으로 할당하는 메모리 영역
    - 메모리의 낮은 주소부터 높은 주소 방향으로 할당

- 데이터 영역 (정적 메모리 영역)
    - 전역 변수, 정적 변수, 상수 등을 저장
    - 프로그램이 시작될 때 할당되고, 프로그램이 종료될 때 소멸함

- 코드 영역 (정적 메모리 영역)
    - 개발자가 작성한 프로그램 함수의 코드가 저장되는 영역
    - CPU는 이 영역에 있는 명령어를 읽어서 실행하는 역할을 함

### 멀티 프로세스

- 운영체제는 프로세스마다 각각 분리된 메모리 영역을 할당함
- 분리된 메모리 영역을 할당하기에 프로세스들은 서로의 영향을 받지 않고, 독립적인 작업을 수행 가능
- 기본적으로 프로세스는 다른 프로세스의 변수나 자료에 접근할 수 없음
- 아예 방법이 없는 것은 아님.
- 프로세스 간 통신(IPC, Inter-Process Communication) 방법을 통해 서로 데이터를 주고받을 수 있음
- 또는 공유 메모리 영역을 만들어서 프로세스 간에 데이터를 공유할 수 있음
- 프로세스는 여러 개가 있을 수 있고, 이런 형태를 **멀티 프로세스**라고 함

---

## 스레드

- 스레드는 프로세스가 운영체제로부터 할당받은 자원을 이용하는 실행 단위
- 프로세스는 반드시 하나 이상의 스레드를 가지고 있고, 여러 스레드를 가질 수 있다.
- 이때 스레드들은 필요한 스택 영역만 할당받고, 나머지 힙, 데이터 영역, 코드 영역은 공유한다.
- 하지만 스택 영역은 각자 따로 할당받기 때문에 스레드 간에 지역 변수나 매개변수는 공유하지 않는다.

### 스레드와 CPU의 관계

- 스레드는 운영체제의 스케줄러에 의해서 CPU를 할당받아 실행됨
- 이 말은 즉 CPU의 최소 실행 단위가 스레드라는 의미
- 스케줄러 알고리즘에 의해서 프로세스에 속한 1개의 스레드가 선점해서 CPU를 사용하고, 다른 스레드는 대기 상태가 된다.
- 스레드 사이에 선점이 발생할 때 CPU의 실행 흐름이 전환되는데 이걸 **컨텍스트 스위칭**이라고 한다.
    - EX) 스레드 1이 실행되고 있다가 스레드 2가 CPU를 할당받으면 스레드 1은 대기 상태가 되고, 스레드 2가 실행될 때 (컨텍스트 스위칭) 스레드 1의 상태를 저장하고, 스레드 2의 상태를 복원한다.

---

## 프로세스와 스레드의 관계

- 프로세스는 여러 자식 프로세스 중 하나의 프로세스에 문제가 발생하면 해당 프로세스만 죽고 다른 프로세스는 무관하다. (프로그램 전체의 안정성을 확보)
- 프로세스간 컨텍스트 스위칭이 발생하면 메모리 영역이 분리되어 있기에 레지스터 정리, 캐시 메모리 비우기 등 무거운 작업들 때문에 시간 비용이 많이 든다.
- 프로세스간 통신 기법이 어렵고 복잡해서 오버헤드가 크다. (오버헤드: 부가적인 작업으로 인해 발생하는 시간, 비용, 자원 낭비)
- 프로세스는 독립적인 메모리 영역을 할당받기에 리소스 소모가 크다.

- 스레드는 여러 스레드 중에 하나의 스레드에 문제가 발생하면 해당 프로세스 전체가 죽는다. (프로그램 전체의 안정성은 떨어짐)
- 스레드는 프로세스의 메모리 영역을 공유하기에 컨텍스트 스위칭 시간이 비교적 짧고, 리소스를 효율적으로 쓴다
- 스레드 간 통신이 쉽고 빠르다. (공유 메모리 영역을 사용하기 때문)
- 스레드는 공유 메모리 영역에 동시에 접근할 수 있기 때문에 동기화 문제를 꼭 생각해야 한다.
